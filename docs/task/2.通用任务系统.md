
## [课件目录](https://github.com/jhq0113/yafr/blob/master/docs/index.md)

## [1.生产者消费者](https://github.com/jhq0113/yafr/blob/master/docs/task/1.生产者消费者.md)

# 通过任务消费系统

## 设计

![img](https://github.com/jhq0113/yafr/blob/master/docs/通用任务消费系统设计.png)

## 表

```sql
CREATE TABLE `task_config` (
  `id` int(10) unsigned NOT NULL AUTO_INCREMENT COMMENT 'channel id',
  `host` varchar(32) DEFAULT NULL COMMENT 'host',
  `port` int(10) unsigned DEFAULT NULL COMMENT '端口',
  `db` tinyint(3) unsigned DEFAULT NULL COMMENT '数据库',
  `channel` varchar(128) DEFAULT NULL COMMENT '频道',
  `rpc_address` varchar(255) CHARACTER SET utf8mb4 DEFAULT NULL COMMENT 'rpc服务地址',
  `rpc_method` varchar(32) CHARACTER SET utf8mb4 DEFAULT NULL COMMENT 'rpc服务方法',
  `add_time` timestamp NULL DEFAULT CURRENT_TIMESTAMP COMMENT '添加时间',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;


CREATE TABLE `task_list` (
  `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '任务id',
  `task_config_id` int(10) unsigned DEFAULT NULL COMMENT '任务配置id',
  `param` varchar(1024) DEFAULT NULL COMMENT '调用参数',
  `status` tinyint(3) unsigned DEFAULT '0' COMMENT '状态(0处理中，1成功，2失败)',
  `add_time` timestamp NULL DEFAULT CURRENT_TIMESTAMP COMMENT '添加时间',
  `deal_time` timestamp NULL DEFAULT NULL COMMENT '处理时间',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
```