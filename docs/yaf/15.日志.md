## [目录](https://github.com/jhq0113/yafr/blob/master/docs/index.md)

## [14.psr-3](https://github.com/jhq0113/yafr/blob/master/docs/yaf/14.psr-3.md)

# 日志实现

```php
<?php 
/**
     * @param mixed  $level
     * @param string|array $message
     * @param array  $context
     * @return null|void
     * @throws ConfigException
     * Author: Jiang Haiqiang
     * Email : jhq0113@163.com
     * Date: 2018/6/15
     * Time: 15:38
     */
    public function log($level, $message, array $context = [])
    {
        if(is_string($message)) {
            $message = StringHelper::interpolate($message,$context);
            $message = [
                'message' => $message
            ];
        }

        $message['serviceTraceId'] = $this->serviceTraceId;

        if(!isset($this->formatter)) {
            $this->formatter = new Json();
        }

        $this->formatter = Container::insure($this->formatter);

        if($this->formatter instanceof Format) {
            $message = $this->formatter->format($message,$level);
        }

        if(!isset($this->logFile)) {
            throw new ConfigException('请配置日志的文件地址');
        }

        $logPath = dirname($this->logFile);
        if (!is_dir($logPath)) {
            FileHelper::mkdirP($logPath);
        }

        if (($fp = @fopen($this->logFile, 'a')) === false) {
            return;
        }

        @flock($fp, LOCK_EX);
        @fwrite($fp, $message.PHP_EOL);
        @flock($fp, LOCK_UN);
        @fclose($fp);

        if (isset($this->fileMode)) {
            @chmod($this->logFile, $this->fileMode);
        }
    }
?>
```